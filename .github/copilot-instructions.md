# הוראות ל-Copilot — פרויקט שיעורי בית מתמטיקה

## תיאור הפרויקט
דף אינטראקטיבי לשיעורי בית במתמטיקה לתלמידי כיתה י׳ (10th grade) בעברית (RTL).
הנושאים: **נגזרת מורכבת** (כלל השרשרת), **נגזרת מכפלה**, **הוצאת גורם משותף מקסימלי**, ו**חקירת פונקציה**.

## מבנה הקבצים
- **index.html** — מבנה הדף: 5 חלקים (א–ה), כל חלק עם הסבר/דוגמה + מיכל לשאלות דינמיות
- **script.js** (~1850 שורות) — כל הלוגיקה: מחוללי שאלות, בניית DOM, בדיקת תשובות, פיצ'רים
- **style.css** (~1260 שורות) — עיצוב RTL מלא, אנימציות, צבעים לפי חלק, responsive
- **google-apps-script.js** — קוד Google Apps Script לשליחת תוצאות ל-Google Sheets (placeholder)

## 5 חלקי התוכן
| חלק | נושא | שאלות | משקל |
|------|-------|--------|------|
| א | נגזרת מורכבת (כלל השרשרת) | 1–4 | 5 נק׳ כל אחת |
| ב | חקירת פונקציה מורכבת | 5א–5ג | 10 נק׳ כל אחת (משקל כפול) |
| ג | נגזרת מכפלה | 6–9 | 5 נק׳ כל אחת |
| ד | הוצאת גורם משותף מקסימלי | 10–13 | 5 נק׳ כל אחת |
| ה | חקירת פונקציה — מכפלה | 14א–14ב | 5 נק׳ כל אחת |

## סוגי שאלות
- **guided** — שאלה מודרכת עם שלבים (dropdowns), כל שלב נפתח רק אחרי שהקודם נענה נכון
- **radio** — בחירה מרובה (radio buttons)

## 10 פיצ'רים מיוחדים שמומשו
1. **Per-step feedback** — משוב מיידי (✓/✗) בכל שלב בשאלות מודרכות
2. **רמזים (Hints)** — כפתור 💡 שחושף רמז לכל שאלה
3. **הסברים לתשובות שגויות** — כשהתלמיד טועה, מוצג הסבר מפורט
4. **ניקוד חלקי (Partial credit)** — שאלות מודרכות מקבלות ציון יחסי לפי שלבים נכונים
5. **נעילת שלבים (Step locking)** — שלב הבא נפתח רק אחרי תשובה נכונה בקודם
6. **דוגמה מפורטת בחלק ד׳** — worked example עם שלבים
7. **גרפים אינטראקטיביים** — כפתור 📈 בשאלות חקירה מצייר גרף על canvas
8. **localStorage** — שמירת התקדמות אוטומטית, נטען מחדש בכניסה חוזרת
9. **פירוט תוצאות לפי נושא** — בר ציון צבעוני לכל חלק
10. **קונפטי** — אנימציית חגיגה בציון 90+

## טכנולוגיות
- **HTML/CSS/JS** טהור — אין frameworks
- **MathJax v3** — רינדור נוסחאות מתמטיות, עם fallback CDN
- **RTL** — `dir="rtl"`, `lang="he"`, CSS `direction: rtl`
- **Google Fonts** — Heebo (weights 300–900)

## כללים טכניים חשובים
1. **MathJax בתוך `<select>`**: לא ניתן לרנדר MathJax בתוך אלמנט `<option>`. לכן יש פונקציה `latexToUnicode()` שממירה LaTeX לסימני Unicode (חזקות עליונות, ·, שברים). ה-`value` נשאר LaTeX מקורי, רק ה-display text מומר.
2. **BiDi**: הפונקציה `tex(s)` מחזירה `\(…\)` ו-CSS מבודד את `mjx-container` עם `direction: ltr; unicode-bidi: isolate`.
3. **טבלאות סימנים**: משתמשות ב-`\lt` ו-`\gt` במקום `<` ו-`>` כדי למנוע בעיות HTML parsing.
4. **מאקרו `\heb`**: מוגדר ב-MathJax config כ-`\unicode{x200F}\text{#1}` לטקסט עברי בתוך נוסחאות.
5. **`numMap`**: מיפוי מ-ID שאלה (`q5a`) למספר תצוגה עברי (`5א`).
6. **`wrongDetails`**: שומר את `q.title` עם delimiters `\(…\)` כדי ש-MathJax ירנדר ברשימת השאלות השגויות.
7. **`MathJax.typesetPromise()`**: נקרא אחרי כל הוספת תוכן דינמי — ב-`buildQuiz()`, ב-`checkAnswers()`, וב-`showResults()`.

## מחוללי שאלות (Generators)
כל שאלה נוצרת דינמית עם ערכים אקראיים. המחוללים:
- `genQ1()` עד `genQ4()` — חלק א
- `genQ5a()`, `genQ5b()`, `genQ5c()` — חלק ב (משתפים state דרך `q5State`)
- `genQ6()` עד `genQ9()` — חלק ג
- `genQ10()` עד `genQ13()` — חלק ד
- `genQ14a()`, `genQ14b()` — חלק ה (משתפים state דרך `q14State`)

## מבנה אובייקט שאלה
```js
{
  id: 'q1',           // מזהה ייחודי
  section: 'a',       // חלק (a–e)
  title: '\\(…\\)',   // כותרת עם LaTeX
  titlePrefix: '…',   // טקסט לפני הכותרת
  titleSuffix: '…',   // טקסט אחרי הכותרת (אופציונלי)
  type: 'guided',     // 'guided' או 'radio'
  weight: 5,          // משקל בנקודות (5 או 10)
  hint: '…',          // רמז
  graphExpr: '…',     // ביטוי לגרף (אופציונלי)
  steps: [            // רק ב-guided
    {
      text: '…',
      fieldId: '…',
      options: ['בחר/י...', ...],
      correct: '…',
      scoring: false,  // true רק לשלב האחרון (הניקודי)
      explanation: '…'
    }
  ],
  // רק ב-radio:
  options: [...],
  correct: '…',
  prompt: '…',
  explanation: '…'
}
```

## סגנון קוד
- שפת UI: **עברית**
- הערות בקוד: עברית + אנגלית
- שמות משתנים/פונקציות: **אנגלית** (camelCase)
- כל ה-CSS classes: **אנגלית** עם מקפים (kebab-case)

## בעיות שתוקנו (היסטוריה)
- תיקון BiDi של MathJax ב-RTL
- תיקון fallback CDN ל-MathJax
- תיקון אנימציות CSS
- תיקון טבלאות סימנים (שימוש ב-`\lt`/`\gt`)
- תיקון הסברי טבלת סימנים ב-q5b (ציון כל 3 הגורמים: 4x, (x-c), (x+c))
- תיקון MathJax ברשימת שאלות שגויות (שמירת delimiters + typesetPromise)
- תיקון אימוג'י שבור בחלק ד׳
- תיקון עקביות "הפונקציה הפנימית" בשאלות 4 ו-5א

## GitHub Pages
הריפו נמצא ב: https://github.com/AmitBenDavid91/math-homework
ניתן להפעיל GitHub Pages (Settings → Pages → Source: master, / root) לגישה ישירה מהדפדפן.
